<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width = device-width" />
    <title>我的博客</title>
    <link rel="icon" href="/style/images/resizeApi.png">
    <link href="/style/layui/css/layui.css?201908072006" rel="stylesheet" />
    <link href="/style/css/main.css?v=201908062156" rel="stylesheet" />
    <link href="/style/css/layout.css" rel="stylesheet" />
    <link href="/style/layui/css/modules/layer/default/layer.css" rel="stylesheet" />
    <link href="/style/css/common.css" rel="stylesheet" />
</head>

<body>
    <div class="fly-header layui-bg-black" style="padding:  0 0 0 97px;">
        <div class="layui-header" style="width: 85%;">
            <a href="../home/index.html?pagepath=article">
                <img style="margin: -20px 0 0 0px" src="/style/images/logo1.png">
            </a>
            <div class="header-menu">
                <div class="nav">
                    <a href="javaScript:;" class="active">广场</a>
                    <a href="javaScript:;">文章</a>
                    <a href="javascript:;">微语</a>
                    <a href="about.html">关于本站</a>
                </div>
            </div>

            <ul id="top" class="layui-nav layui-layout-right">
                <div id="nologin" style="opacity: 0.5;font-size:15px;padding:18px;margin-right:-5px;display: none"><a
                        href="../login/login.html"><i class="layui-icon layui-icon-username"></i>还未登录</a></div>
                <div id="user" style="display: none;">
                    <li class="layui-nav-item"><a href="../user/profile.html?tab=4"> 我的消息<span
                                class="layui-badge"></span></a></li>
                    <li class="layui-nav-item" lay-unselect="">
                        <a href="javascript:;"><img id="photo" class="layui-nav-img"></a>
                        <dl class="layui-nav-child">
                            <dd><a href="../user/profile.html?tab=1">个人资料</a></dd>
                            <dd><button class="layui-btn layui-btn-primary" onclick="loginOut()"
                                    style="color: #555 !important">退出</button></dd>
                        </dl>
                    </li>
                </div>
        </div>
        </ul>
    </div>
    </div>
    <iframe id="console" frameborder=0 width="100%" height="100%" scrolling=no marginwidth='0' marginheight='0'
        noresize="noresize" src="square.html"></iframe>
    <div class="footer-wrap">
        <div class="footer w1000">          
            <div class="footer-info footer-info-author">
                 作者：Mr.Han
            </div>
            <div class="footer-info">
                邮箱:<span class="email">2704027639@qq.com</span>
            </div>
            <div style="text-align: center;">
                Copyright © Mr.Han <a href="http://beian.miit.gov.cn" target="_blank">鄂ICP备20001892号-1</a>
            </div>
        </div>
    </div>
    <script src="/style/js/jquery.js"></script>
    <script src="/style/layui/layui.js"></script>
    <script src="/style/js/request.js?v=20112171144"></script>
    <script src="/style/js/util.js"></script>
    <script src="/style/js/nav.js?v=201912171009"></script>
    <script src="/style/js/signalr.js"></script>
    <script src="/style/js/login.js"></script>
    <script>
        layui.use(['element', 'layer'], function () {
            var date=new Date();
            var element = layui.element;
            element.render('nav');
            initLoad();         
            var connection = new signalR.HubConnectionBuilder().withUrl(httpAddress+'chatHub').build();
            connection.on('InvokeMessage', (reviceMessage) => {
                var v = reviceMessage;
                $('.layui-badge').html(reviceMessage.data);
                $('.layui-badge').addClass('blink');
            });
            $.ajax({
                url: url + 'user/userInfo',
                type: 'get',
                dataType: 'json',
                beforeSend: function (xhr) {
                    doBeforeSend(xhr);
                },
                success: function (response) {
                    if (response.code == '1') {
                        $("#nologin").show();
                        $("#user").hide();
                    }
                    else {
                        $("#nologin").hide();
                        $("#user").show();
                        if (response.data.headPhoto == "") {
                            $("#photo").attr('src', '/style/images/weixi.jpg');
                        }
                        else {
                            $("#photo").attr('src', response.data.headPhoto);
                        }
                        connection.start().then(function () {
                            connection.invoke('SetConnectionMaps', response.data.account);
                        })
                    }
                },
                error: function () {
                    $("#nologin").show();
                    $("#user").hide();
                    layer.msg("服务器响应失败", {
                        icon: 5
                    });
                },
                complete: function (xhr) {
                    doComplete(xhr);
                },
            });
            $.ajax({
                url: url + 'tidings',
                type: 'get',
                dataType: 'text',
                beforeSend: function (xhr) {
                    doBeforeSend(xhr);
                },
                success: function (response) {
                    $('.layui-badge').html(response);
                },
                complete: function (xhr) {
                    doComplete(xhr);
                },
            });
        });
    </script>

</body>

</html>